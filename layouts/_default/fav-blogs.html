{{ define "main" }}
<style>
  .fav-blogs-page { 
    max-width: 700px; /* Slightly narrower for a centered, clean feel */
    margin: 0 auto; 
    padding: 2rem 1rem; 
    line-height: 1.5;
    color: currentColor; /* Inherits theme text color for dark mode */
  }

  .header h1 {
    font-size: 1.8rem;
    font-weight: 800;
    margin-bottom: 0.5rem;
  }

  .page-intro {
    margin-bottom: 2.5rem;
    font-size: 0.95rem;
    opacity: 0.8;
  }

  .blog-entry { 
    margin-bottom: 1.5rem; 
    padding-bottom: 1rem;
    border-bottom: 1px solid rgba(128, 128, 128, 0.1); 
  }

  /* Author Names - High contrast for dark mode */
  .blog-entry h2 { 
    color: currentColor; 
    margin: 0 0 0.4rem 0; 
    font-size: 1.1rem; /* Slightly smaller, more refined */
    font-weight: 700;
    opacity: 0.9;
  }

  .feed-list { 
    list-style: none; 
    padding: 0; 
    margin: 0;
  }

  /* Link Highlighting */
  .feed-link {
    font-size: 0.95rem; 
    font-weight: 500;
    text-decoration: none;
    color: #3b82f6; /* Modern blue */
    transition: color 0.2s ease;
  }

  .feed-link:hover {
    text-decoration: underline;
    color: #60a5fa;
  }

  /* Date Styling */
  .post-date {
    display: inline-block;
    font-size: 0.75rem; 
    opacity: 0.5;
    margin-left: 8px; /* Places date next to title if space allows */
    white-space: nowrap;
  }

  /* Error/Empty state */
  .feed-error {
    font-size: 0.85rem;
    font-style: italic;
    opacity: 0.4;
  }

  footer {
    margin-top: 3rem;
    font-size: 0.75rem;
    opacity: 0.4;
    text-align: center;
  }
</style>

<div class="fav-blogs-page">
  <header class="header">
    <h1>{{ .Title }}</h1>
    <div class="page-intro">{{ .Content }}</div>
  </header>

  {{ range .Site.Data.favs.blogs }}
    <section class="blog-entry">
      <h2>{{ .name }}</h2>
      
      {{ $options := dict "headers" (dict "User-Agent" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36") }}
      {{ $feed := resources.GetRemote .url $options }}
      {{ with $feed }}
        {{ $data := . | transform.Unmarshal }}
        {{/* Handle Atom (.entry) or RSS (.channel.item) */}}
        {{ $items := $data.entry | default $data.channel.item }}
        <ul class="feed-list">
        {{ range first 3 $items }}
            
            {{/* 1. Extract Title: Handles the map[#text:...] */}}
            {{ $title := "" }}
            {{ if reflect.IsMap .title }}
            {{ $title = index .title "#text" | default .title.content }}
            {{ else }}
            {{ $title = .title }}
            {{ end }}

            {{/* 2. Extract Link: Handles the slice/list of maps with hyphens */}}
            {{ $link := "" }}
            {{ if reflect.IsSlice .link }}
            {{/* Loop through the links to find the 'alternate' one */}}
            {{ range .link }}
                {{ if eq (index . "-rel") "alternate" }}
                {{ $link = index . "-href" }}
                {{ end }}
            {{ end }}
            {{ else if reflect.IsMap .link }}
            {{ $link = index . "-href" | default .link.href }}
            {{ else }}
            {{ $link = .link }}
            {{ end }}

            {{/* Fallback to ID if link is still empty */}}
            {{ if not $link }}
            {{ $link = .id }}
            {{ end }}
            
            <li class="feed-item">
            <a href="{{ $link | safeURL }}" class="feed-link" target="_blank" rel="noopener">
                {{ $title }}
            </a>
            <span class="post-date">
                {{ $date := .published | default .pubDate | default .updated }}
                {{ if $date }}{{ $date | dateFormat "Jan 2, 2006" }}{{ end }}
            </span>
            </li>
        {{ end }}
        </ul>
      {{ else }}
        <p class="feed-error">Feed temporarily offline</p>
      {{ end }}
    </section>
  {{ end }}
  
  <footer>
    Last synced: {{ now | dateFormat "January 2, 2006" }}
  </footer>
</div>
{{ end }}